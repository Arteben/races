  <HTML>
  <head>
    <meta charset="utf-8"/>
    <title> Races </title>
    <style>
    </style>
    <script src="js/playground-base.js"></script>
    <script src="js/raphael.js"></script>
  <head/>
  <body>
    <script>
    
    var params = {};

    var ENGINE = {};

    ENGINE.game = {
      
      // create game board
      create: function(){
            
        var app = this.app;
        var paper = app._svg_;
        var sizes = app._sizes_;
        var road_set = paper.set();
        
        var road_params = {
          cell: 20,
          radius: 50,
          diff: 0.1,
        };   
        
        // create array for road
        var road_array = (function(params){

          //count for create arrays;          
          var n, m;
                    
          var array = [];
          for (n = 0; n < params.radius; n++){
            array[n] = [];
            for (m = 0; m < params.radius; m++){
              array[n][m] = 0;
            }
          }
          
          var begin_insland = Math.floor(params.radius * 0.25) - 1;
          var end_insland = Math.floor(params.radius * 0.75) - 1;
          
          var i, j;
          
          for(i in array){
            if (i == 0 || i == array.length - 1) {
              for(j in array[i]){
                array[i][j] = 1;
              } 
            } else if((i > 0 && i < begin_insland) || (i >= end_insland && i < array.length)){
              for (j in array[i]){
                if (j == 0 || j == array[i].length - 1) {
                  array[i][j] = 1;
                }
              }
            } else if (i >= begin_insland && i < end_insland){
              for (j in array[i]){
                if (j == 0 || j == array[i].length - 1 || (j >= begin_insland && j < end_insland)){
                  array[i][j] = 1;
                }
              }
            }
          }
          
          var half = Math.floor(params.radius / 2);
          var road = false;
          
          for (j in array[half]){
            if (array[half][j] == 0 || road){
              road = true;
              if (array[half][j] == 1){
                console.log('break!');
                break;
              } else {
                array[half][j] = 2;
              }
            }
          }
          
          return array;
                    
        }(road_params));
        
        var field = {
          board: null,
          road: null,
          finish: null,
        };

        field.road = paper.set();
        field.finish = paper.set();
        
        var n, m;   
        var cell = road_params.cell;
        
        for (n = 0; n < road_array.length; n++){
          for (m = 0; m < road_array.length; m++){
            if (road_array[n][m] === 0){
              field.road.push(paper.rect(n * cell, m * cell, cell, cell));
            } else if (road_array[n][m] == 2){
              field.finish.push(paper.rect(n * cell, m * cell, cell, cell));
            } 
          }
        }
        
        console.log
        
        field.road.attr({'fill': '#FFF', 'stroke': '#111', 'stroke-width': 0.1});
        field.finish.attr({'fill': '#499', 'stroke': '#444', 'stroke-width': 0});
        
        paper.setViewBox(cell * Math.floor(road_params.radius * 0.25), 0,
                                                  sizes.w * 0.8, sizes.h * 0.8, true);
                
      },
      
      resize: function(){
      },
    };

    // main Application of the game
    var app = new PLAYGROUND.Application({

      //there is loading resorce
      create: function(){

        this._sizes_ = {
          w: window.innerWidth,
          h: window.innerHeight,
        };
        
         this._svg_ = Raphael(0, 0, this._sizes_.w, this._sizes_.h);
      },
      // call after loading
      ready: function(){
        
        this.setState(ENGINE.game);
      },
      
      resize: function(){
        
        this._sizes_.w = window.innerWidth;
        this._sizes_.h = window.innerHeight;
        
        this._svg_.canvas.style.width = this._svg_.canvas.width = this._svg_.width = this._sizes_.w;
        this._svg_.canvas.style.height = this._svg_.canvas.height = this._svg_.height = this._sizes_.h;
        
      },   
    });

    </script>
  </body>
</html>
